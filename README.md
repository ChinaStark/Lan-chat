# Lan-Chat 应用 README

这是一个基于现代安卓技术栈构建的本地局域网（LAN）实时聊天应用。项目旨在展示如何利用最新的 Jetpack 库和最佳实践来构建一个功能完整、架构清晰、性能优异且高度健壮的应用程序。

## 主要功能

*   **用户配置**: 首次启动应用时，会引导用户设置自己的专属昵称。此昵称将被保存在本地，并在后续聊天中作为发送者名称。
*   **实时聊天**: 在同一个局域网内，用户可以实时地发送和接收文本消息。
*   **多媒体消息**: 支持发送图片和各类文件附件。
*   **智能连接管理**:
    *   **自动重连**: 当应用从后台返回前台，或网络发生波动时，应用会在2分钟内持续自动尝试重新连接，对用户透明。
    *   **手动重连**: 若自动重连超时，界面会提供一个“点击重试”按钮，将控制权交还给用户。
*   **状态驱动的界面**: 根据用户的登录状态和网络连接状态，自动显示不同的界面（如“欢迎页”、“聊天页”、“加载中”、“连接失败”等）。

## 技术亮点

本项目完全摒弃了过时的开发模式，全面拥抱 Google 官方推荐的现代化安卓开发（Modern Android Development）技术栈。

### 1. **100% Jetpack Compose UI**
整个应用的用户界面完全由 Jetpack Compose 构建，无任何 XML 布局文件。
*   **声明式UI**: 我们通过描述“在某个状态下，UI应该长什么样”来构建界面，而不是手动进行UI控件的增删改查。
*   **状态驱动**: UI 的所有更新都由 `State` （状态）的变化驱动。例如，通过改变 `username` 状态，应用能自动地从 `UserProfileScreen`（用户信息页）切换到 `ChatScreen`（聊天主页），逻辑清晰且高效。

### 2. **清晰的 MVVM 架构**
项目严格遵循 Model-View-ViewModel 架构，实现了完美的“关注点分离”。
*   **View (视图层)**: 由 Composable 函数（`MainActivity`, `ChatScreen` 等）构成。它们是“无状态”的，只负责渲染 ViewModel 提供的状态，并将用户交互事件通知给 ViewModel。
*   **ViewModel (`ChatViewModel`)**: UI 的“大脑”。它持有并管理所有UI状态（如消息列表、连接状态），并负责处理所有与UI相关的逻辑（如我们的“2分钟重连”策略）。它能在屏幕旋转等配置变更中存活，保证了数据的稳定。
*   **Model (模型层)**: 由 Repository（`ChatRepository`）、数据源（`WebSocketManager`）和偏好设置（`UserPreferences`）组成。它负责所有的数据操作，为 ViewModel 提供干净、统一的数据接口。

### 3. **强大的异步处理: Kotlin Coroutines & Flow**
项目中所有的后台操作（网络、延时、文件读写）都通过 Kotlin 协程完成，确保了UI线程的绝对流畅。
*   **`viewModelScope`**: 所有的协程任务都在这个与 ViewModel 生命周期绑定的作用域内启动，确保了当用户离开界面时，所有后台任务都能被自动取消，杜绝内存泄漏。
*   **`StateFlow`**: 作为“响应式”数据管道，`StateFlow` 将底层的连接状态和消息数据源源不断地、安全地“流向”UI层。UI通过 `collectAsStateWithLifecycle` 进行订阅，既保证了数据的一致性，又实现了生命周期安全。

### 4. **健壮的网络连接管理**
这是本项目的核心亮点之一。我们没有采用简单的“连不上就失败”的逻辑，而是在 `ChatViewModel` 中实现了一套生产级别的重连策略，能够从容应对移动设备不稳定的网络环境。

### 5. **混合网络模型**
项目聪明地结合了两种主流的网络通信方式：
*   **WebSocket (OkHttp)**: 用于聊天消息的收发。这是一种低延迟、高效率的双向通信方式，是实时聊天的最佳选择。
*   **Retrofit**: 用于文件上传等传统的“请求-响应”式场景，为后续扩展（如拉取历史消息）打下了坚实的基础。
